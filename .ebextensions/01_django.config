commands:
    setvars:
        command: /opt/elasticbeanstalk/bin/get-config environment | jq -r 'to_entries | .[] | "export \(.key)=\"\(.value)\""' > /etc/profile.d/sh.local
    install_node:
        command: |
            sudo curl --silent --location https://rpm.nodesource.com/setup_8.x | sudo bash -
            sudo yum -y install nodejs 
    install_yarn:
        command: |
            sudo wget https://dl.yarnpkg.com/rpm/yarn.repo -O /etc/yum.repos.d/yarn.repo
            sudo yum -y install yarn

container_commands:
    01_migrate:
        command: "source $PYTHONPATH/activate && python manage.py migrate"
        leader_only: true
    02_populate_db:
        command: "source $PYTHONPATH/activate && python manage.py populate"
        leader_only: true

option_settings:
    aws:elasticbeanstalk:container:python:
        WSGIPath: motorwash.wsgi:application
        NumProcesses: 4
        NumThreads: 2
    aws:elasticbeanstalk:environment:proxy:staticfiles:
        /static: staticfiles
    aws:elasticbeanstalk:application:environment:
        DJANGO_SETTINGS_MODULE: motorwash.settings
        LOG_LEVEL: INFO
        LOG_FILE_PATH: /tmp/django-app.log

files:
    "/opt/elasticbeanstalk/tasks/taillogs.d/django.conf":
        mode: "000755"
        owner: root
        group: root
        content: |
            /var/log/app-logs/django.log
            /var/log/cfn-init.log
