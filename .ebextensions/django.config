files:
    "/etc/cron.d/cron_process":
        mode: "000644"
        owner: root
        group: root
        content: |
            * * * * * root /usr/local/bin/task_process.sh

    "/usr/local/bin/task_process.sh":
        mode: "000755"
        owner: root
        group: root
        content: |
            #!/bin/bash
            exec &>> /tmp/cron_capture_log.txt
            date > /tmp/date
            source /var/app/venv/staging-LQM1lest/bin/activate
            cd /var/app/current
            python manage.py process_tasks

commands:
    remove_old_cron:
        command: "rm -f /etc/cron.d/cron_process.bak"

container_commands:
    01_migrate:
        command: "source $PYTHONPATH/activate && python manage.py migrate"
        leader_only: true
    02_populate_db:
        command: "source $PYTHONPATH/activate && python manage.py populate"
        leader_only: true

option_settings:
    aws:elasticbeanstalk:container:python:
        WSGIPath: motorwash.wsgi:application
    aws:elasticbeanstalk:environment:proxy:staticfiles:
        /static: staticfiles
    aws:elasticbeanstalk:application:environment:
        DJANGO_SETTINGS_MODULE: motorwash.settings